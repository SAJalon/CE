# C#äº‹ä»¶å…¨é¢è§£æ

![image.png](https://github.com/user-attachments/assets/8619f972-6ced-4b18-8f88-4d2406e3fe7e)

**æœ¬æ–‡æ”¶å½•äºã€Šæ§åˆ¶å·¥ç¨‹è‡ªå­¦æŒ‡å—ã€‹ä¸Šä½æœºç¯‡ï¼ŒÂ©Â 2025Â SAJalon**

---

## å‰è¨€

äº‹ä»¶æ˜¯C#ä¸­éå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå®ƒå®ç°äº†è§‚å¯Ÿè€…æ¨¡å¼ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿå¤„ç†å¯¹è±¡é—´çš„é€šçŸ¥æœºåˆ¶ã€‚

è§‚å¯Ÿè€…æ¨¡å¼æ˜¯è®¾è®¡æ¨¡å¼ä¸­çš„ä¸€ç§ï¼Œå®šä¹‰äº†å¯¹è±¡é—´çš„ä¸€å¯¹å¤šä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡æ”¹å˜çŠ¶æ€æ—¶ï¼Œæ‰€æœ‰ä¾èµ–å®ƒçš„å¯¹è±¡éƒ½ä¼šæ”¶åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°ã€‚

æœ¬æ–‡å°†å…¨é¢è§£æC#ä¸­äº‹ä»¶çš„ä½¿ç”¨æ–¹æ³•ã€‚

## ä»€ä¹ˆæ˜¯äº‹ä»¶ï¼Ÿ

**å§”æ‰˜ï¼ˆDelegateï¼‰**ï¼šæ–¹æ³•çš„å¼•ç”¨ï¼Œå¯ä»¥åƒå˜é‡ä¸€æ ·ä¼ é€’å’Œè°ƒç”¨æ–¹æ³•ã€‚

**äº‹ä»¶ï¼ˆEventï¼‰**ï¼šåŸºäºå§”æ‰˜çš„å°è£…ï¼ŒæŠŠâ€œå§”æ‰˜â€åŒ…è£…äº†ä¸€ä¸‹ï¼Œåœ¨å§”æ‰˜çš„åŸºç¡€ä¸Šæä¾›äº†æ›´å®‰å…¨çš„æ–¹æ³•è°ƒç”¨æœºåˆ¶ã€‚

**å‘å¸ƒè€…ï¼ˆPublisherï¼‰**ï¼šæ˜¯åŒ…å«äº‹ä»¶çš„ç±»ï¼Œè´Ÿè´£åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å¼•å‘ï¼ˆè§¦å‘ï¼‰äº‹ä»¶ã€‚

**è®¢é˜…è€…ï¼ˆSubscriberï¼‰**ï¼šæ˜¯æ³¨å†Œäº‹ä»¶çš„ç±»ï¼Œå½“äº‹ä»¶è¢«å¼•å‘æ—¶ä¼šæ”¶åˆ°é€šçŸ¥å¹¶æ‰§è¡Œç›¸åº”çš„å¤„ç†é€»è¾‘ã€‚

## äº‹ä»¶çš„åŸºæœ¬è¯­æ³•

```csharp
// å£°æ˜äº‹ä»¶
public event EventHandler MyEvent;

// å¼•å‘äº‹ä»¶
MyEvent?.Invoke(this, EventArgs.Empty);

```

*   **EventHandler**ï¼š.NETÂ FrameworkÂ æä¾›çš„æ ‡å‡†äº‹ä»¶å¤„ç†ç¨‹åºå§”æ‰˜ç±»å‹ï¼Œç­¾åé€šå¸¸æ˜¯ï¼š`voidÂ EventHandler(objectÂ sender,Â EventArgsÂ e)`
    
*   **EventArgs**ï¼šäº‹ä»¶å‚æ•°çš„åŸºç±»ï¼Œç”¨äºä¼ é€’äº‹ä»¶ç›¸å…³çš„æ•°æ®ã€‚
    
*   **Invoke**ï¼šç”¨äºå®‰å…¨åœ°è°ƒç”¨å§”æ‰˜çš„æ–¹æ³•ï¼Œé€šå¸¸é…åˆç©ºæ¡ä»¶è¿ç®—ç¬¦Â `?.`Â ä½¿ç”¨ã€‚
    
*   **+=Â å’ŒÂ -=Â è¿ç®—ç¬¦**ï¼šç”¨äºè®¢é˜…å’Œå–æ¶ˆè®¢é˜…äº‹ä»¶çš„è¿ç®—ç¬¦ã€‚
    

### äº‹ä»¶å£°æ˜çš„åŸºæœ¬è¯­æ³•

```csharp
// ä½¿ç”¨EventHandler<T>æ³›å‹å§”æ‰˜
public event EventHandler<MyEventArgs> MyEvent;

// ä½¿ç”¨è‡ªå®šä¹‰å§”æ‰˜
public delegate void MyEventHandler(object sender, MyEventArgs e);
public event MyEventHandler MyEvent;

// ä½¿ç”¨Actionå§”æ‰˜ï¼ˆç®€å•äº‹ä»¶ï¼‰
public event Action<string> MessageEvent;
```

### äº‹ä»¶çš„åŸºæœ¬æ“ä½œ

```csharp
// è®¢é˜…äº‹ä»¶
publisher.MyEvent += EventHandlerMethod;

// å–æ¶ˆè®¢é˜…äº‹ä»¶
publisher.MyEvent -= EventHandlerMethod;

// å¼•å‘äº‹ä»¶
MyEvent?.Invoke(this, new MyEventArgs());
```

### äº‹ä»¶è¯­æ³•ä½¿ç”¨ç¤ºä¾‹

```csharp
using System;

// 1. å®šä¹‰äº‹ä»¶å‘å¸ƒè€…ç±»
public class SimplePublisher
{
    // 2. å£°æ˜äº‹ä»¶ - ä½¿ç”¨æ ‡å‡†çš„EventHandlerå§”æ‰˜
    public event EventHandler SimpleEvent;
    
    // 3. æä¾›å¼•å‘äº‹ä»¶çš„æ–¹æ³•
    public void DoSomething()
    {
        Console.WriteLine("å‘å¸ƒè€…æ‰§è¡Œäº†æŸäº›æ“ä½œ");
        
        // 4. å¼•å‘äº‹ä»¶ï¼ˆé€šçŸ¥æ‰€æœ‰è®¢é˜…è€…ï¼‰
        SimpleEvent?.Invoke(this, EventArgs.Empty);
    }
}

// 5. å®šä¹‰äº‹ä»¶è®¢é˜…è€…ç±»
public class SimpleSubscriber
{
    private string name;
    
    public SimpleSubscriber(string subscriberName)
    {
        name = subscriberName;
    }
    
    // 6. äº‹ä»¶å¤„ç†æ–¹æ³•
    public void OnSimpleEvent(object sender, EventArgs e)
    {
        Console.WriteLine($"{name} æ”¶åˆ°äº†äº‹ä»¶é€šçŸ¥ï¼");
    }
}

class Program
{
    static void Main(string[] args)
    {
        // 7. åˆ›å»ºå‘å¸ƒè€…å’Œè®¢é˜…è€…
        SimplePublisher publisher = new SimplePublisher();
        SimpleSubscriber subscriber1 = new SimpleSubscriber("è®¢é˜…è€…1");
        SimpleSubscriber subscriber2 = new SimpleSubscriber("è®¢é˜…è€…2");
        
        // 8. è®¢é˜…äº‹ä»¶
        publisher.SimpleEvent += subscriber1.OnSimpleEvent;
        publisher.SimpleEvent += subscriber2.OnSimpleEvent;
        
        Console.WriteLine("ç¬¬ä¸€æ¬¡æ‰§è¡Œæ“ä½œï¼š");
        publisher.DoSomething();
        
        Console.WriteLine("\nå–æ¶ˆè®¢é˜…è€…1ï¼š");
        // 9. å–æ¶ˆè®¢é˜…
        publisher.SimpleEvent -= subscriber1.OnSimpleEvent;
        
        Console.WriteLine("ç¬¬äºŒæ¬¡æ‰§è¡Œæ“ä½œï¼š");
        publisher.DoSomething();
    }
}
```

**è¾“å‡ºç»“æœ**ï¼š

```csharp
ç¬¬ä¸€æ¬¡æ‰§è¡Œæ“ä½œï¼š
å‘å¸ƒè€…æ‰§è¡Œäº†æŸäº›æ“ä½œ
è®¢é˜…è€…1 æ”¶åˆ°äº†äº‹ä»¶é€šçŸ¥ï¼
è®¢é˜…è€…2 æ”¶åˆ°äº†äº‹ä»¶é€šçŸ¥ï¼

å–æ¶ˆè®¢é˜…è€…1ï¼š
ç¬¬äºŒæ¬¡æ‰§è¡Œæ“ä½œï¼š
å‘å¸ƒè€…æ‰§è¡Œäº†æŸäº›æ“ä½œ
è®¢é˜…è€…2 æ”¶åˆ°äº†äº‹ä»¶é€šçŸ¥ï¼
```

### äº‹ä»¶çš„å·¥ä½œæµç¨‹å›¾è§£

```mermaid
graph TD
    A[åˆ›å»ºå‘å¸ƒè€…] --> B[å£°æ˜äº‹ä»¶]
    B --> C[åˆ›å»ºè®¢é˜…è€…]
    C --> D[è®¢é˜…äº‹ä»¶]
    D --> E[å‘å¸ƒè€…æ‰§è¡Œæ“ä½œ]
    E --> F{äº‹ä»¶æ˜¯å¦æœ‰è®¢é˜…è€…?}
    F -->|æ˜¯| G[å¼•å‘äº‹ä»¶]
    F -->|å¦| H[ä¸æ‰§è¡Œä»»ä½•æ“ä½œ]
    G --> I[é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…]
    I --> J[æ‰§è¡Œè®¢é˜…è€…çš„å¤„ç†æ–¹æ³•]
    
    style A fill:#FFE4B5,stroke:#333
    style B fill:#FFE4B5,stroke:#333
    style C fill:#98FB98,stroke:#333
    style D fill:#87CEEB,stroke:#333
    style E fill:#FFE4B5,stroke:#333
    style G fill:#FFE4B5,stroke:#333
    style I fill:#87CEEB,stroke:#333
    style J fill:#98FB98,stroke:#333
```

## äº‹ä»¶å’Œå§”æ‰˜çš„åŒºåˆ«

> **äº‹ä»¶æ˜¯å§”æ‰˜çš„ç‰¹æ®Šç”¨æ³•ã€‚**

> **äº‹ä»¶æ˜¯å§”æ‰˜çš„"å®‰å…¨åŒ…è£…"ã€‚**

**å§”æ‰˜å°±åƒæ˜¯ä¸€ä¸ªå¼€æ”¾çš„é€šçŸ¥å…¬å‘Šæ ã€‚**

**ä»»ä½•äººéƒ½å¯ä»¥æŸ¥çœ‹é€šçŸ¥å•ï¼Œä»»ä½•äººä¹Ÿéƒ½èƒ½å¼ è´´ã€ä¿®æ”¹ã€æ’•é™¤é€šçŸ¥å•ã€‚**

**è€Œäº‹ä»¶å°±åƒæ˜¯ä¸€ä¸ªå¸¦é”çš„å…¬å‘Šæ ï¼Œè™½ç„¶ä»»ä½•äººéƒ½èƒ½æŸ¥çœ‹é€šçŸ¥å•ï¼Œä½†åªæœ‰ç®¡ç†å‘˜æ‰èƒ½å¼ è´´ã€ä¿®æ”¹ã€æ’•é™¤é€šçŸ¥å•ã€‚**

```mermaid
graph LR
    subgraph "å§”æ‰˜ - å®Œå…¨å¼€æ”¾"
        A[å§”æ‰˜å˜é‡] --> B[= èµ‹å€¼]
        A --> C[+= æ·»åŠ æ–¹æ³•]
        A --> D[-= ç§»é™¤æ–¹æ³•]
        A --> E[ï¼ˆï¼‰ç›´æ¥è°ƒç”¨]
        A --> F[= null æ¸…ç©º]
    end
    
    subgraph "äº‹ä»¶ - å—é™è®¿é—®"
        G[äº‹ä»¶å˜é‡] --> H[x += æ·»åŠ æ–¹æ³•<br/>âœ“ å¤–éƒ¨å¯ä»¥]
        G --> I[x -= ç§»é™¤æ–¹æ³•<br/>âœ“ å¤–éƒ¨å¯ä»¥]
        G --> J[x = èµ‹å€¼<br/>âœ— å¤–éƒ¨ç¦æ­¢]
        G --> K[xï¼ˆï¼‰ç›´æ¥è°ƒç”¨<br/>âœ— å¤–éƒ¨ç¦æ­¢]
        G --> L[x = null æ¸…ç©º<br/>âœ— å¤–éƒ¨ç¦æ­¢]
    end
```
```mermaid
graph TD
    A[æ²¡æœ‰äº‹ä»¶ä¿æŠ¤çš„é—®é¢˜] --> B[å¤–éƒ¨ä»£ç å¯ä»¥<br/>1. æ¸…ç©ºæ‰€æœ‰å¤„ç†æ–¹æ³•<br/>2. æ›¿æ¢æ‰€æœ‰å¤„ç†æ–¹æ³•<br/>3. ç›´æ¥è§¦å‘å†…éƒ¨äº‹ä»¶]
    
    C[ä½¿ç”¨äº‹ä»¶çš„å¥½å¤„] --> D[å¤–éƒ¨ä»£ç åªèƒ½<br/>1. æ·»åŠ è‡ªå·±çš„å¤„ç†æ–¹æ³•<br/>2. ç§»é™¤è‡ªå·±çš„å¤„ç†æ–¹æ³•<br/>3. æ— æ³•ç ´ååŸæœ‰é€»è¾‘]
```

**äº‹ä»¶æœ¬è´¨ä¸Šå°±æ˜¯å¸¦æœ‰è®¿é—®é™åˆ¶çš„å§”æ‰˜ã€‚**

### ä»£ç ç¤ºä¾‹å¯¹æ¯”

**å§”æ‰˜çš„å®Œå…¨æ§åˆ¶**

```c#
class Program
{
    // 1. å£°æ˜å§”æ‰˜ç±»å‹
    public delegate void MyDelegate(string message);
    
    static void Main(string[] args)
    {
        // 2. åˆ›å»ºå§”æ‰˜å®ä¾‹
        MyDelegate myDelegate = null;
        
        // 3. å§”æ‰˜å¯ä»¥è¢«å®Œå…¨æ§åˆ¶ï¼ˆä»»ä½•æ“ä½œéƒ½å¯ä»¥ï¼‰
        myDelegate = SayHello;           // âœ“ å¯ä»¥ç›´æ¥èµ‹å€¼
        myDelegate += SayGoodbye;        // âœ“ å¯ä»¥æ·»åŠ æ–¹æ³•
        myDelegate();                    // âœ“ å¯ä»¥ç›´æ¥è°ƒç”¨
        myDelegate = null;               // âœ“ å¯ä»¥æ¸…ç©º
        myDelegate -= SayGoodbye;        // âœ“ å¯ä»¥ç§»é™¤æ–¹æ³•
    }
    
    static void SayHello(string msg)
    {
        Console.WriteLine($"Hello: {msg}");
    }
    
    static void SayGoodbye(string msg)
    {
        Console.WriteLine($"Goodbye: {msg}");
    }
}
```

**äº‹ä»¶çš„å—é™è®¿é—®**

```c#
class Button
{
    // 1. å£°æ˜å§”æ‰˜ç±»å‹
    public delegate void ClickHandler(string buttonText);
    
    // 2. å£°æ˜äº‹ä»¶ï¼ˆåŸºäºå§”æ‰˜ï¼‰
    public event ClickHandler OnClick;
    
    private string text;
    
    public Button(string buttonText)
    {
        text = buttonText;
    }
    
    // 3. ç±»å†…éƒ¨å¯ä»¥å®Œå…¨æ§åˆ¶äº‹ä»¶
    public void SimulateClick()
    {
        // ç±»å†…éƒ¨å¯ä»¥è§¦å‘äº‹ä»¶
        OnClick?.Invoke(text);  // âœ“ å¯ä»¥è°ƒç”¨
    }
    
    public void TestEvent()
    {
        OnClick = null;         // âœ“ ç±»å†…éƒ¨å¯ä»¥èµ‹å€¼
        OnClick += SayHello;    // âœ“ ç±»å†…éƒ¨å¯ä»¥æ·»åŠ 
        OnClick -= SayHello;    // âœ“ ç±»å†…éƒ¨å¯ä»¥ç§»é™¤
    }
}

class Program
{
    static void Main(string[] args)
    {
        Button button = new Button("æäº¤æŒ‰é’®");
        
        // 4. å¤–éƒ¨åªèƒ½è®¢é˜…å’Œå–æ¶ˆè®¢é˜…
        button.OnClick += ShowMessage;    // âœ“ å¯ä»¥æ·»åŠ 
        button.OnClick += LogClick;       // âœ“ å¯ä»¥æ·»åŠ 
        button.OnClick -= ShowMessage;    // âœ“ å¯ä»¥ç§»é™¤
        
        // 5. å¤–éƒ¨ä¸èƒ½è¿›è¡Œçš„å±é™©æ“ä½œ
        // button.OnClick = null;         // âœ— ç¼–è¯‘é”™è¯¯ï¼
        // button.OnClick();              // âœ— ç¼–è¯‘é”™è¯¯ï¼
        // button.OnClick = SomeMethod;   // âœ— ç¼–è¯‘é”™è¯¯ï¼
        
        // 6. è§¦å‘äº‹ä»¶ï¼ˆé€šè¿‡å…¬å…±æ–¹æ³•ï¼‰
        button.SimulateClick();
    }
    
    static void ShowMessage(string buttonText)
    {
        Console.WriteLine($"æ˜¾ç¤ºæ¶ˆæ¯ï¼š{buttonText}è¢«ç‚¹å‡»äº†");
    }
    
    static void LogClick(string buttonText)
    {
        Console.WriteLine($"è®°å½•æ—¥å¿—ï¼š{buttonText}è¢«ç‚¹å‡»");
    }
}
```

## äº‹ä»¶åŸºç¡€æ¡ˆä¾‹ï¼šç®€å•çš„æŒ‰é’®ç‚¹å‡»äº‹ä»¶

è®©æˆ‘ä»¬ä»ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­å¼€å§‹ï¼š

```csharp
using System;

// 1. å®šä¹‰äº‹ä»¶å‚æ•°ç±»
public class ButtonClickEventArgs : EventArgs
{
    public string ButtonName { get; set; }
    public DateTime ClickTime { get; set; }
}

// 2. å®šä¹‰æŒ‰é’®ç±»ï¼ˆäº‹ä»¶å‘å¸ƒè€…ï¼‰
public class Button
{
    // å£°æ˜äº‹ä»¶
    public event EventHandler<ButtonClickEventArgs> Clicked;
    
    public string Name { get; set; }
    
    public Button(string name)
    {
        Name = name;
    }
    
    // å¼•å‘äº‹ä»¶çš„æ–¹æ³•
    public void Click()
    {
        Console.WriteLine($"æŒ‰é’® {Name} è¢«ç‚¹å‡»äº†");
        
        // æ£€æŸ¥æ˜¯å¦æœ‰è®¢é˜…è€…ï¼Œç„¶åå¼•å‘äº‹ä»¶
        Clicked?.Invoke(this, new ButtonClickEventArgs
        {
            ButtonName = Name,
            ClickTime = DateTime.Now
        });
    }
}

// 3. å®šä¹‰ç›‘å¬å™¨ç±»ï¼ˆäº‹ä»¶è®¢é˜…è€…ï¼‰
public class ButtonListener
{
    private string listenerName;
    
    public ButtonListener(string name)
    {
        listenerName = name;
    }
    
    // äº‹ä»¶å¤„ç†æ–¹æ³•
    public void OnButtonClicked(object sender, ButtonClickEventArgs e)
    {
        Console.WriteLine($"{listenerName} æ”¶åˆ°é€šçŸ¥ï¼š{e.ButtonName} åœ¨ {e.ClickTime:HH:mm:ss} è¢«ç‚¹å‡»");
    }
}

class Program
{

    static void Main(string[ ] args)

    {
        // åˆ›å»ºæŒ‰é’®
        Button button = new Button("æäº¤æŒ‰é’®");
        
        // åˆ›å»ºç›‘å¬å™¨
        ButtonListener listener1 = new ButtonListener("ç›‘å¬å™¨1");
        ButtonListener listener2 = new ButtonListener("ç›‘å¬å™¨2");
        
        // è®¢é˜…äº‹ä»¶
        button.Clicked += listener1.OnButtonClicked;
        button.Clicked += listener2.OnButtonClicked;
        
        // ç‚¹å‡»æŒ‰é’®
        button.Click();
        
        Console.WriteLine("\nå–æ¶ˆç›‘å¬å™¨1çš„è®¢é˜…");
        
        // å–æ¶ˆè®¢é˜…
        button.Clicked -= listener1.OnButtonClicked;
        
        // å†æ¬¡ç‚¹å‡»æŒ‰é’®
        button.Click();
    }
}

```

**è¾“å‡ºç»“æœï¼š**

```plaintext
æŒ‰é’® æäº¤æŒ‰é’® è¢«ç‚¹å‡»äº†
ç›‘å¬å™¨1 æ”¶åˆ°é€šçŸ¥ï¼šæäº¤æŒ‰é’® åœ¨ 14:30:25 è¢«ç‚¹å‡»
ç›‘å¬å™¨2 æ”¶åˆ°é€šçŸ¥ï¼šæäº¤æŒ‰é’® åœ¨ 14:30:25 è¢«ç‚¹å‡»

å–æ¶ˆç›‘å¬å™¨1çš„è®¢é˜…
æŒ‰é’® æäº¤æŒ‰é’® è¢«ç‚¹å‡»äº†
ç›‘å¬å™¨2 æ”¶åˆ°é€šçŸ¥ï¼šæäº¤æŒ‰é’® åœ¨ 14:30:25 è¢«ç‚¹å‡»

```

### å¦‚æœæŒ‰é’®ä½¿ç”¨å§”æ‰˜è€Œä¸æ˜¯äº‹ä»¶

```c#
// å±é™©çš„å®ç°æ–¹å¼
class BadButton
{
    public delegate void ClickHandler(string buttonText);
    public ClickHandler OnClick;  // ä½¿ç”¨å§”æ‰˜è€Œä¸æ˜¯äº‹ä»¶
    
    public void Click()
    {
        OnClick?.Invoke("æŒ‰é’®");
    }
}

class Program
{
    static void Main(string[] args)
    {
        BadButton button = new BadButton();
        button.OnClick += HandleClick1;
        button.OnClick += HandleClick2;
        
        // å±é™©æ“ä½œï¼å¤–éƒ¨ä»£ç å¯ä»¥ç ´åæŒ‰é’®çš„æ­£å¸¸å·¥ä½œ
        button.OnClick = null;  // æ¸…ç©ºæ‰€æœ‰å¤„ç†æ–¹æ³•ï¼
        // æˆ–è€…
        button.OnClick = HandleClick1;  // æ›¿æ¢æ‰€æœ‰å¤„ç†æ–¹æ³•ï¼
        // æˆ–è€…
        button.OnClick();  // ç›´æ¥è§¦å‘äº‹ä»¶ï¼
    }
    
    static void HandleClick1(string text)
    {
        Console.WriteLine("å¤„ç†1");
    }
    
    static void HandleClick2(string text)
    {
        Console.WriteLine("å¤„ç†2");
    }
}
```

## äº‹ä»¶çš„åº•å±‚åŸç†å›¾è§£

```mermaid
graph TD
    A[äº‹ä»¶å‘å¸ƒè€…] -->|å¼•å‘äº‹ä»¶| B[äº‹ä»¶å§”æ‰˜é“¾è¡¨]
    B --> C[è®¢é˜…è€…1]
    B --> D[è®¢é˜…è€…2]
    B --> E[è®¢é˜…è€…3]
    
    style A fill:#FFE4B5,stroke:#333
    style B fill:#87CEEB,stroke:#333
    style C fill:#98FB98,stroke:#333
    style D fill:#98FB98,stroke:#333
    style E fill:#98FB98,stroke:#333

```

## ä½¿ç”¨Lambdaè¡¨è¾¾å¼ç®€åŒ–äº‹ä»¶å¤„ç†

å¯¹äºç®€å•çš„äº‹ä»¶å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Lambdaè¡¨è¾¾å¼æ¥ç®€åŒ–ä»£ç ï¼š

```csharp
using System;

public class SimpleEventExample
{
    // å£°æ˜äº‹ä»¶
    public event Action<string> MessageReceived;
    
    // å¼•å‘äº‹ä»¶
    public void SendMessage(string message)
    {
        Console.WriteLine($"å‘é€æ¶ˆæ¯: {message}");
        MessageReceived?.Invoke(message);
    }
}

class Program
{

    static void Main(string[ ] args)

    {
        SimpleEventExample example = new SimpleEventExample();
        
        // ä½¿ç”¨Lambdaè¡¨è¾¾å¼è®¢é˜…äº‹ä»¶
        example.MessageReceived += (message) => 
            Console.WriteLine($"Lambdaå¤„ç†: æ”¶åˆ°æ¶ˆæ¯ '{message}'");
            
        // ä½¿ç”¨åŒ¿åæ–¹æ³•è®¢é˜…äº‹ä»¶
        example.MessageReceived += delegate(string message)
        {
            Console.WriteLine($"åŒ¿åæ–¹æ³•å¤„ç†: æ”¶åˆ°æ¶ˆæ¯ '{message}'");
        };
        
        // å‘é€æ¶ˆæ¯
        example.SendMessage("Hello World!");
    }
}

```

**è¾“å‡ºç»“æœï¼š**

```plaintext
å‘é€æ¶ˆæ¯: Hello World!
Lambdaå¤„ç†: æ”¶åˆ°æ¶ˆæ¯ 'Hello World!'
åŒ¿åæ–¹æ³•å¤„ç†: æ”¶åˆ°æ¶ˆæ¯ 'Hello World!'
```

## å¸¦å‚æ•°çš„äº‹ä»¶ç¤ºä¾‹

```csharp
using System;

// 1. è‡ªå®šä¹‰äº‹ä»¶å‚æ•°ç±»ï¼ˆç»§æ‰¿è‡ªEventArgsï¼‰
public class CustomEventArgs : EventArgs
{
    public string Message { get; set; }
    public int Number { get; set; }
    public DateTime Time { get; set; }
}

// 2. äº‹ä»¶å‘å¸ƒè€…
public class PublisherWithArgs
{
    // 3. å£°æ˜å¸¦è‡ªå®šä¹‰å‚æ•°çš„äº‹ä»¶
    public event EventHandler<CustomEventArgs> DataChanged;
    
    public void ChangeData(string message, int number)
    {
        Console.WriteLine($"å‘å¸ƒè€…æ”¹å˜æ•°æ®: {message}, {number}");
        
        // 4. å¼•å‘äº‹ä»¶å¹¶ä¼ é€’å‚æ•°
        DataChanged?.Invoke(this, new CustomEventArgs
        {
            Message = message,
            Number = number,
            Time = DateTime.Now
        });
    }
}

// 5. äº‹ä»¶è®¢é˜…è€…
public class SubscriberWithArgs
{
    private string name;
    
    public SubscriberWithArgs(string subscriberName)
    {
        name = subscriberName;
    }
    
    // 6. å¤„ç†å¸¦å‚æ•°çš„äº‹ä»¶
    public void OnDataChanged(object sender, CustomEventArgs e)
    {
        Console.WriteLine($"{name} æ”¶åˆ°æ•°æ®å˜æ›´é€šçŸ¥:");
        Console.WriteLine($"  æ¶ˆæ¯: {e.Message}");
        Console.WriteLine($"  æ•°å­—: {e.Number}");
        Console.WriteLine($"  æ—¶é—´: {e.Time:HH:mm:ss}");
    }
}

class Program
{
    static void Main(string[] args)
    {
        PublisherWithArgs publisher = new PublisherWithArgs();
        SubscriberWithArgs subscriber = new SubscriberWithArgs("æ•°æ®ç›‘å¬å™¨");
        
        // è®¢é˜…äº‹ä»¶
        publisher.DataChanged += subscriber.OnDataChanged;
        
        // è§¦å‘äº‹ä»¶
        publisher.ChangeData("ç”¨æˆ·ç™»å½•", 12345);
        Console.WriteLine();
        publisher.ChangeData("è®¢å•åˆ›å»º", 67890);
    }
}
```

**è¾“å‡ºç»“æœï¼š**

```plaintext
å‘å¸ƒè€…æ”¹å˜æ•°æ®: ç”¨æˆ·ç™»å½•, 12345
æ•°æ®ç›‘å¬å™¨ æ”¶åˆ°æ•°æ®å˜æ›´é€šçŸ¥:
  æ¶ˆæ¯: ç”¨æˆ·ç™»å½•
  æ•°å­—: 12345
  æ—¶é—´: 14:30:25

å‘å¸ƒè€…æ”¹å˜æ•°æ®: è®¢å•åˆ›å»º, 67890
æ•°æ®ç›‘å¬å™¨ æ”¶åˆ°æ•°æ®å˜æ›´é€šçŸ¥:
  æ¶ˆæ¯: è®¢å•åˆ›å»º
  æ•°å­—: 67890
  æ—¶é—´: 14:30:25
```

## äº‹ä»¶çš„é«˜çº§ç‰¹æ€§

### 1.Â äº‹ä»¶è®¿é—®å™¨æ§åˆ¶

```csharp
public class EventPublisher
{
    private EventHandler _myEvent;
    
    // è‡ªå®šä¹‰äº‹ä»¶è®¿é—®å™¨
    public event EventHandler MyEvent
    {
        add
        {
            Console.WriteLine("æ·»åŠ è®¢é˜…è€…");
            _myEvent += value;
        }
        remove
        {
            Console.WriteLine("ç§»é™¤è®¢é˜…è€…");
            _myEvent -= value;
        }
    }
    
    public void RaiseEvent()
    {
        _myEvent?.Invoke(this, EventArgs.Empty);
    }
}

```

### 2.Â é™æ€äº‹ä»¶

```csharp
public class StaticEventExample
{
    // é™æ€äº‹ä»¶
    public static event Action<string> GlobalMessage;
    
    public static void BroadcastMessage(string message)
    {
        GlobalMessage?.Invoke(message);
    }
}

```

## å®é™…åº”ç”¨æ¡ˆä¾‹ï¼šæ¸©åº¦ç›‘æ§ç³»ç»Ÿ

```csharp
using System;

// æ¸©åº¦æ•°æ®ç±»
public class TemperatureEventArgs : EventArgs
{
    public double Temperature { get; set; }
    public DateTime Time { get; set; }
    public string Location { get; set; }
}

// æ¸©åº¦ä¼ æ„Ÿå™¨ï¼ˆå‘å¸ƒè€…ï¼‰
public class TemperatureSensor
{
    public event EventHandler<TemperatureEventArgs> TemperatureChanged;
    
    public string Location { get; set; }
    private Random random = new Random();
    
    public TemperatureSensor(string location)
    {
        Location = location;
    }
    
    // æ¨¡æ‹Ÿæ¸©åº¦è¯»å–
    public void ReadTemperature()
    {
        double temperature = 20 + random.NextDouble() * 10; // 20-30åº¦
        
        Console.WriteLine($"ä¼ æ„Ÿå™¨ {Location} è¯»å–æ¸©åº¦: {temperature:F1}Â°C");
        
        // å¼•å‘äº‹ä»¶
        TemperatureChanged?.Invoke(this, new TemperatureEventArgs
        {
            Temperature = temperature,
            Time = DateTime.Now,
            Location = Location
        });
    }
}

// è­¦æŠ¥ç³»ç»Ÿï¼ˆè®¢é˜…è€…ï¼‰
public class AlertSystem
{
    private const double THRESHOLD = 28.0;
    
    public void OnTemperatureChanged(object sender, TemperatureEventArgs e)
    {
        if (e.Temperature > THRESHOLD)
        {
            Console.WriteLine($"âš ï¸ è­¦æŠ¥! {e.Location} æ¸©åº¦è¿‡é«˜: {e.Temperature:F1}Â°C at {e.Time:HH:mm:ss}");
        }
    }
}

// æ•°æ®è®°å½•å™¨ï¼ˆè®¢é˜…è€…ï¼‰
public class DataLogger
{
    public void OnTemperatureChanged(object sender, TemperatureEventArgs e)
    {
        Console.WriteLine($"ğŸ“ è®°å½•æ•°æ®: {e.Location} - {e.Temperature:F1}Â°C at {e.Time:HH:mm:ss}");
    }
}

class Program
{

    static void Main(string[ ] args)

    {
        // åˆ›å»ºä¼ æ„Ÿå™¨
        TemperatureSensor sensor1 = new TemperatureSensor("å®¢å…");
        TemperatureSensor sensor2 = new TemperatureSensor("å§å®¤");
        
        // åˆ›å»ºè®¢é˜…è€…
        AlertSystem alertSystem = new AlertSystem();
        DataLogger dataLogger = new DataLogger();
        
        // è®¢é˜…äº‹ä»¶
        sensor1.TemperatureChanged += alertSystem.OnTemperatureChanged;
        sensor1.TemperatureChanged += dataLogger.OnTemperatureChanged;
        
        sensor2.TemperatureChanged += alertSystem.OnTemperatureChanged;
        sensor2.TemperatureChanged += dataLogger.OnTemperatureChanged;
        
        // æ¨¡æ‹Ÿæ¸©åº¦ç›‘æ§
        Console.WriteLine("å¼€å§‹æ¸©åº¦ç›‘æ§...");
        for (int i = 0; i < 5; i++)
        {
            sensor1.ReadTemperature();
            sensor2.ReadTemperature();
            Console.WriteLine("---");
            System.Threading.Thread.Sleep(1000);
        }
    }
}

```

## äº‹ä»¶ç³»ç»Ÿæ¶æ„å›¾

```mermaid
graph TB
    subgraph å‘å¸ƒè€…å±‚
        A[æ¸©åº¦ä¼ æ„Ÿå™¨1] -->|TemperatureChanged| B[äº‹ä»¶å§”æ‰˜]
        C[æ¸©åº¦ä¼ æ„Ÿå™¨2] -->|TemperatureChanged| D[äº‹ä»¶å§”æ‰˜]
    end
    
    subgraph è®¢é˜…è€…å±‚
        E[è­¦æŠ¥ç³»ç»Ÿ] & F[æ•°æ®è®°å½•å™¨] --> B
        G[è­¦æŠ¥ç³»ç»Ÿ] & H[æ•°æ®è®°å½•å™¨] --> D
    end
    
    style A fill:#FFE4B5,stroke:#333
    style C fill:#FFE4B5,stroke:#333
    style B fill:#87CEEB,stroke:#333
    style D fill:#87CEEB,stroke:#333
    style E fill:#98FB98,stroke:#333
    style F fill:#98FB98,stroke:#333
    style G fill:#98FB98,stroke:#333
    style H fill:#98FB98,stroke:#333

```

## äº‹ä»¶çš„æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ

**ç©ºæ¡ä»¶è¿ç®—ç¬¦çš„ä½¿ç”¨**

```c#
// æ¨èå†™æ³• - å®‰å…¨å¼•å‘äº‹ä»¶
MyEvent?.Invoke(this, EventArgs.Empty);

// ä¸æ¨èå†™æ³• - å¯èƒ½å¼•å‘NullReferenceException
if (MyEvent != null)
    MyEvent(this, EventArgs.Empty);
```

**åŠæ—¶å–æ¶ˆè®¢é˜…**

```c#
// åœ¨é€‚å½“çš„æ—¶å€™å–æ¶ˆè®¢é˜…ï¼Œé¿å…å†…å­˜æ³„æ¼
publisher.MyEvent -= subscriber.EventHandler;
```

**äº‹ä»¶å¤„ç†æ–¹æ³•çš„å‘½åè§„èŒƒ**

```c#
// æ¨èçš„å‘½åæ–¹å¼ï¼šOn + äº‹ä»¶å
public void OnDataChanged(object sender, DataEventArgs e)
{
    // å¤„ç†é€»è¾‘
}
```

## å¸¸è§é—®é¢˜è§£ç­”

**Q1:Â äº‹ä»¶å’Œå§”æ‰˜æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**

*   äº‹ä»¶æ˜¯å§”æ‰˜çš„ç‰¹æ®Šå½¢å¼ï¼Œå§”æ‰˜å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è¢«è°ƒç”¨ï¼Œè€Œäº‹ä»¶åªèƒ½åœ¨å£°æ˜å®ƒçš„ç±»ä¸­è¢«å¼•å‘ï¼Œåœ¨ç±»å¤–éƒ¨åªèƒ½é€šè¿‡+=å’Œ-=è¿›è¡Œè®¢é˜…å’Œå–æ¶ˆè®¢é˜…ã€‚
    

**Q2:Â ä¸ºä»€ä¹ˆè¦ä½¿ç”¨EventArgs.Emptyï¼Ÿ**

*   å½“äº‹ä»¶ä¸éœ€è¦ä¼ é€’ä»»ä½•å‚æ•°æ—¶ï¼Œä½¿ç”¨EventArgs.Emptyå¯ä»¥é¿å…åˆ›å»ºæ–°çš„EventArgså®ä¾‹ï¼Œæé«˜æ€§èƒ½ã€‚
    

**Q3:Â å¤šä¸ªè®¢é˜…è€…ä¼šæŒ‰ä»€ä¹ˆé¡ºåºæ‰§è¡Œï¼Ÿ**

*   å¤šä¸ªè®¢é˜…è€…ä¼šæŒ‰ç…§è®¢é˜…çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œä½†ä¸å»ºè®®ä¾èµ–ç‰¹å®šçš„æ‰§è¡Œé¡ºåºã€‚
    

**Q4:Â å¦‚ä½•ä¼ é€’å¤šä¸ªå‚æ•°ï¼Ÿ**

*   ç»§æ‰¿EventArgsç±»ï¼Œæ·»åŠ éœ€è¦çš„å±æ€§ï¼Œæˆ–è€…ä½¿ç”¨å…ƒç»„ã€è‡ªå®šä¹‰ç±»ç­‰æ–¹å¼ã€‚
